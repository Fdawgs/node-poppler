language: node_js

cache: yarn

node_js:
    - 'lts/*'
    - 'node'

os:
    - windows
    - osx

# See https://travis-ci.community/t/build-doesnt-finish-after-completing-tests/288/9
env:
    - YARN_GPG=no

# safelist
branches:
    only:
        - master
        - /^feat/.*$/
        - /^fix/.*$/
        - /^dependabot/.*$/

matrix:
    allow_failures:
        - os: osx

script: echo "Running tests against $(node -v)..."

jobs:
    include:
        - stage: Produce Coverage
          node_js: node
          script: jest --coverage && cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js && rm -rf ./coverage
        - stage: Check for Code Duplication
          node_js: node
          script: yarn dupe-check
